<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>App Si Donar</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
        <!-- START - include this css-->
        <link rel="stylesheet" href="../libs/css/si-donar.css">
        <link href="../libs/css/font-awesome/css/all.css" rel="stylesheet"> 
        <!-- END - include this css-->
        <!-- START - include this script to access local storage function etc-->
        <script src="../libs/js/si-donar.js"></script>
        <!-- END - include this script to access local storage function etc-->
        <script>
            $(document).ready(function(){
                var imgChat = localStorage.getItem("chat-img");
                var nameChat = localStorage.getItem("chat-name");
                var cari_darah = JSON.parse(localStorage.getItem("cari_darah"));
                var golDarRhes = cari_darah[0] + cari_darah[1];
                
                var username = getUsername();

                var today = new Date();
               
                
                if(nameChat !== ""){
                    $('#name-chat').append(nameChat);
                }
                if(imgChat !== ""){
                    document.getElementById('img-chat').src = imgChat;
                }
                var countClick = 0;
                $("#send-chat-msg").click(function(){
                    var h = today.getHours();
                    var m = today.getMinutes();

                    var sendDiv = `<div id ="send-chat" style="margin-top: 30px;float: right;background-color: #CFF7CF;
                    box-shadow: 0px -4px 4px rgba(0, 0, 0, 0.1), 0px 4px 4px rgba(0, 0, 0, 0.1), 0px 4px 4px rgba(0, 0, 0, 0.1), 0px 4px 4px rgba(0, 0, 0, 0.1);
                    border-radius: 9px;
                    width: 230px; padding: 10px;font-size: 14px;">
                    Selamat malam ${nameChat} mohon maaf mengganggu, saya butuh darah dengan golongan ${golDarRhes}. Berkenankah Anda menjadi pendonor?
                        <br/>
                        <div style="float:right; font-weight:bold; font-size: 11px;">
                            ${h}:${m}
                        </div>
                    </div>`;

                    var receiveDiv = `<div id ="send-chat" style="margin-top: 30px;float: left;background-color: #FFFFFF;
                    box-shadow: 0px -4px 4px rgba(0, 0, 0, 0.1), 0px 4px 4px rgba(0, 0, 0, 0.1), 0px 4px 4px rgba(0, 0, 0, 0.1), 0px 4px 4px rgba(0, 0, 0, 0.1);
                    border-radius: 9px;
                    width: 230px; padding: 10px;font-size: 14px;">
                    Selamat malam ${username} kebetulan golongan darah saya juga ${golDarRhes}. Oke saya berkenan!
                        <br/>
                        <div style="float:right; font-weight:bold; font-size: 11px;">
                            ${h}:${m}
                        </div>
                    </div>`;
                    countClick ++;
                    document.getElementById('chat-bottom').style.marginTop= (screen.height - ((countClick*100) + 200)) + "px";
                    $('#chat-bottom').append(sendDiv);
                    setTimeout(function(){ 
                        countClick ++;
                        document.getElementById('chat-bottom').style.marginTop= (screen.height - ((countClick*100) + 200)) + "px";
                        $('#chat-bottom').append(receiveDiv);
                    }, 1000);
                    window.scrollTo(0, screen.height + 100);
                    
                });
            });
        </script>
    </head>
    <body style="background-color:lightgrey;overflow-x: hidden;width: 98%">
        <div class="chat-area" style="padding: 10px;">
            <div class="row">
                <div class="col" style="overflow-x: hidden;">
                    <div id="chat-bottom">
                
                    </div>
                </div>
                
            </div>
            <div class="row">
                <div class="col"  style="overflow-x: hidden;">
                    <div id="chat-threshold" style="height:100px;overflow-x: hidden;">
                    </div>
                </div>
            </div>
            
        </div>
        
        <!-- START - INCLUDE THIS BOTTOM AND TOP BAR IN EVERY HTML PAGE AFTER LOGIN -->
        <div id="top-bar" class="top-bar">
            <div class="row">
                <div class="col-1">
                    <i onclick="navigate('search_result')" class="fa fa-chevron-left" style="color:#373A3C;margin-right: 30px;margin-top: 20px;"></i>
                </div>
                <div class="col-2" style="margin-top: 12px;">
                    <img id="img-chat" style="height:35px;width: 35px; border-radius: 100%; border: 2px solid #373A3C">
                </div>
                <div class="col-7" style="margin-top: 8px;">
                    <h5 id="name-chat" style="font-weight: bold;"></h5>
                    <p style="margin-top: -10px;">online</p>
                </div>
            </div>
            
        </div>
        <div id="bottom-bar" class="bottom-bar" style="height: 50px;padding:0;background-color: transparent; box-shadow: none;">
            <div class="container">
                <div class="row">
                    <div class="col-9">
                        <input type="text" id="texting-message" placeholder="Ketik Pesan..." class="form-control" style="width:100%; height: 40px; border: none; border-radius: 10px;"/>
                    </div>
                    <div class="col-3">
                        <img id="send-chat-msg" src="../src/img/icons/send_btn.png" style="margin-top: -10px; margin-left: -10px;position: fixed;">
                    </div>
                </div>
                    
            </div>
        </div>
        <!-- END - INCLUDE THIS BOTTOM AND TOP BAR IN EVERY HTML PAGE AFTER LOGIN -->
    </body>
</html>